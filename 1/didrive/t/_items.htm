    <div class="row">
        <div class="col-md-8">
            
        <h3>Товары</h3>

        </div>
    </div>

    <div class="row">
        <div class="col-sm-12 col-lg-9">

        <a href="" style="float:right" 
            id="form1btn" class="btn btn-large btn-warning zoomInRight wow"
            duration="5s" data-toggle="modal" data-target="#myModali"               
            >добавить товары</a>

        <br/>
        <br/>

    <div class="modal fade" id="myModali" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
        <div class="modal-dialog" role="document">
            <div class="modal-content">

                <div class="modal-header">
                {*
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                *}
                <h4 class="modal-title" id="myModalLabel">Заполните поля и отправте заявку</h4>
                </div>

                <form id="ajaxform" action="?level={$level}&option={$now_option}" method="post" style="padding: 0; margin: 0" enctype="multipart/form-data" >

                <div class="modal-body">

                    <div class="form-horizontal">

                    <div class="container-fluid">

                        <div class="row">
                            <div class="col-sm-3" >Каталог &nbsp; </div>
                            <div class="col-sm-9">
                                <select name="cat" class="form-control" >

                                    <option value="" >Выберите</option>

                                    {foreach $cats as $kk => $vv }

                                        {if !isset($vv['up']) }
                                        <option value="{$vv.name_eng}" >+ {$vv.name}</option>

                                            {foreach $cats_sort as $k2 => $v2 }

                                                {if isset($v2.up) && $v2.up == $vv.name_eng }
                                                <option value="{$v2.name_eng}" >+ + {$v2.name}</option>
                                                {/if}

                                            {/foreach}                                    

                                        {/if}
                                        
                                    {/foreach}                                    

                                </select>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-sm-3" >Название &nbsp; </div>
                            <div class="col-sm-9">
                                <input name="name" class="form-control" type="text" rel="Название" >
                                <br/>
                            </div>
                        </div>

                        {*
                        <div class="row">
                            <div class="col-sm-3" >Название по eng&nbsp; </div>
                            <div class="col-sm-9">
                                <input class="form-control" type="text" id="f121" placeholder="" rel="Название по англ" 
                                name="name_eng" >
                                </div>
                        </div>
                        *}
                        
                        <div class="row">
                            <div class="col-sm-2" >Картинка</div>
                            <div class="col-sm-4" >
                                <input type="file" name="img[]" value="" style='width: 100%' />
                                </div>
                            <div class="col-sm-2" >Картинка</div>
                            <div class="col-sm-4" >
                                <input type="file" name="img[]" value="" style='width: 100%' />
                                </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-sm-2" >Картинка</div>
                            <div class="col-sm-4" >
                                <input type="file" name="img[]" value="" style='width: 100%'/>
                                </div>
                            <div class="col-sm-2" >Картинка</div>
                            <div class="col-sm-4" >
                                <input type="file" name="img[]" value="" style='width: 100%' />
                                <br/>
                                </div>
                        </div>

                        <div class="row">
                            
                            <div class="col-sm-3" 
                                 ><b>Цена &nbsp;</b></div>
                            
                            <div class="col-sm-3">
                            <input class="form-control" type="numeric" rel="Сортировка" 
                                   name="price" value="" maxlength="7" />
                            </div>
                            
                            <div class="col-sm-3" 
                                 ><b>Сортировка &nbsp;</b></div>
                            
                            <div class="col-sm-3">
                            <input class="form-control" type="numeric" rel="Сортировка" 
                                   name="sort" value="50" maxlength="2" />
                            </div>
                            
                        </div>


                        <div class="row">
                            
                            <label class="col-sm-3 control-label" 
                            for="f123">Описание</label>
                            
                        </div>
                        <div class="row">
                            
                            <div class="col-sm-12 control-label" >
                                
                            <textarea name="opis" id="editor1" rows="10" style="width: 100%" >
                            </textarea>
                                
                            </div>
                        </div>
                
                <input type="hidden" name="folder" value="{$folder}"/>
                
                </div>
                </div>

                <div class="modal-footer">

                <button type="submit" class="btn btn-warning" >Отправить</button>

                </div>

                </form>

                <div class="modal-body" id="form1res" style="display:none" >
                    <p>Данные отправлены, позвоним в ближайшее время уточнить заявку.</p>
                </div>

            </div>
        </div>
    </div>
    </div>

        {if isset($smarty.request.showitems) }
        <a href="" onclick="$('#ter32').show('slow'); return false;">Выбрать другой каталог</a>
        <table id="ter32" class="table" style="display:none" >
        {else}
        <table class="table" >
        {/if}
        
        <tr>
            <td colspan="2" >Название</td>
            <td>Сортировка</td>
            <td>Тип</td>
            <td>Знаков в описании</td>
            <td>Действия</td>
        </tr>

        {foreach $cats as $kk => $vv }

            {if !isset($vv['up']) }

            <tr>
                <td colspan='2' >
                    
                    <a href="/i.didrive.php?level={$smarty.request.level}&option={$smarty.request.option}&showitems={$vv.name_eng}" >
                    {$vv.name}
                    <br/><small style="font-size: 0.7em" >{$vv.name_eng}</small>
                    </a>
                    </td>
                <td>{$vv.sort}</td>
                <td>{$vv.type}</td>
                <td>{$vv.opis|strlen}</td>
                <td><a
                    onclick="return(confirm('Удаляем каталог и все что ниже ?'))"
                    href="?level={$smarty.request.level}&option={$smarty.request.option}&delitem={$vv.name_eng}" class="color-gray-l color-hover-red" ><span class="glyphicon glyphicon-remove"></span></a></td>
            </tr>
        
                {foreach $cats_sort as $k2 => $v2 }

                    {if isset($v2['up']) && $v2['up'] == $vv['name_eng'] }
                    <tr>
                        <td>- -</td>
                        <td>{$v2.name}
                            <br/><small style="font-size: 0.7em" >{$v2.name_eng}</small>
                            </td>
                        <td>{$v2.sort}</td>
                        <td>{$v2.type}</td>
                        <td>{$v2.opis|strlen}</td>
                        <td><a
                            onclick="return(confirm('Удаляем каталог ?'))"
                            href="?level={$smarty.request.level}&option={$smarty.request.option}&delitem={$v2.name_eng}" class="color-gray-l color-hover-red" ><span class="glyphicon glyphicon-remove"></span></a></td>
                    </tr>
                    {/if}

                {/foreach}                                    
        
                
            {/if}        
        
        {/foreach}

        </table>

        
        {if {$items|@count} > 0 && isset($smarty.request.showitems) } 
        <h3>Товары каталога "{$cats_sort.{$smarty.request.showitems}.name}" <sup><a href="?level={$smarty.request.level}&option={$smarty.request.option}&showitems={$smarty.request.showitems}&rand={$rand}"> обновить список </a></sup></h3>

        <table>

            <thead>
                <tr>
                <td>Название</td>
                <td>Цена</td>
                <td>Статус</td>
                <td>&nbsp;</td>
                </tr>
            </thead>

            <tbody>
            {foreach $items as $k => $v } 
            <tr>
                <td>{$v.name}</td>
                <td>{$v.price}</td>
                <td class="status" >

                    {if $v.status == 'hide' }
                    скрыт
                    {elseif $v.status == 'del' }
                    будет удалён
                    {else}
                    на сайте
                    {/if}

                </td>
                <td class="action" >

                    {*
                    <a href="" >редактировать</a>
                    *}

                    <nobr>
                        ( 
                        <a href="#" class="run" alt="hide" rel="{$v.name_eng}" rev="{$v.cat}" >скрыть</a> / 
                        <a href="#" class="run" alt="show" rel="{$v.name_eng}" rev="{$v.cat}" >показать</a> 
                        )
                    </nobr>

                    <a href="#" class="run" alt="del" rel="{$v.name_eng}" rev="{$v.cat}" >удалить</a>

                    <div id="res_{$v.name_eng}" ></div>

                </td>
            </tr>
            {$r.id} 
            {$r.name}
            {/foreach}
            </tbody>
        </table>
        {/if} 

    {literal}
    <script>
    $(document).ready(function() {
        
    // alert( '11111' );

    $(".action a.run").click( function(){ // пeрeхвaтывaeм всe при сoбытии oтпрaвки
        
        // alert( '22222222' );
        
        $a = $(this).attr('alt');
        $id = $(this).attr('rel');
        $cat = $(this).attr('rev');

            if( $a == 'del' ){ 
                if( confirm('хотите удалить без возможности восстановления ?' ) == false )
                { return false; }
            }

            $.ajax({ // инициaлизируeм ajax зaпрoс

               type: 'POST', // oтпрaвляeм в POST фoрмaтe, мoжнo GET
               url: '/0.site/exe/shop/3/didrive/ajax.php', // путь дo oбрaбoтчикa, у нaс oн лeжит в тoй жe пaпкe
               dataType: 'json', // oтвeт ждeм в json фoрмaтe
               data: 'action='+$a+'&id='+$id+'&cat='+$cat+'&s={/literal}{$s.md5}{literal}', // дaнныe для oтпрaвки

                beforeSend: function(data) { // сoбытиe дo oтпрaвки

                    $( '#res_'+$id ).removeClass( 'bg-success' );
                    $( '#res_'+$id ).removeClass( 'bg-danger' );
                    $( '#res_'+$id ).html( '<img src="/img/load.gif" border="" alt="" />' );
        
        
                    {/literal}{*
                    form.find('input[type="submit"]').attr('disabled', 'disabled'); // нaпримeр, oтключим кнoпку, чтoбы нe жaли пo 100 рaз
                    *}{literal}
        
                    },

                success: function( $d ){ // сoбытиe пoслe удaчнoгo oбрaщeния к сeрвeру и пoлучeния oтвeтa
                   
                    if( $d['end'] == 'ok' )
                    {
                    $( '#res_'+$id ).addClass( 'bg-success' );
                    $( '#res_'+$id ).html( $d['text'] );
                    }
                    else
                    {
                    $( '#res_'+$id ).addClass( 'bg-danger' );
                    $( '#res_'+$id ).html( $d['text'] );
                    }                   
                    
                    
                    {/literal}{*
                    if( data['error'] )
                    { // eсли oбрaбoтчик вeрнул oшибку
                    alert( data['error'] ); // пoкaжeм eё тeкст
                    }
                    else
                    { // eсли всe прoшлo oк
                    // alert('Письмo oтврaвлeнo! Чeкaйтe пoчту! =)'); // пишeм чтo всe oк
                    $( form ).hide();
                    $( '#form1btn' ).hide();
                    $('#form1res').show('slow');
                    }
                    *}{literal}
                    
                }

                ,error: function (xhr, ajaxOptions, thrownError) { // в случae нeудaчнoгo зaвeршeния зaпрoсa к сeрвeру
                     alert( xhr.status ); // пoкaжeм oтвeт сeрвeрa
                     alert( thrownError ); // и тeкст oшибки
                     }
                     
                {/literal}{*
                *}{literal}

                {/literal}{*
                ,complete: function( data ){ // сoбытиe пoслe любoгo исхoдa
                     form.find('input[type="submit"]').prop('disabled', false); // в любoм случae включим кнoпку oбрaтнo
                     }
                *}{literal}

                });

         return false; // вырубaeм стaндaртную oтпрaвку фoрмы
         });

    });
    </script>
    {/literal}        
        
        </div>
    </div>            