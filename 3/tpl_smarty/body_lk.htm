{strip}

<div class='col-xs-6 col-sm-3 col-sm-offset-3 col-md-3 col-md-offset-3 col-lg-3 col-lg-offset-3 text-center' xstyle='border: 1px solid gray;' >

    {*f\pa($smarty.SESSION.now_user)*}

    <style>
        .photo-btn{
            transition-duration: 1s;
            box-shadow: 0 0 2px gray;
            cursor: pointer;
        }
        .photo-btn:HOVER{
            box-shadow: 0 0 8px gray;
        }
    </style>          

    {if $smarty.SESSION.now_user.data.avatar|count_characters:true > 3 }
    <div class="user-info__avatar"><img 
            src="/sys.image.jpg.php?folder=kl1706mu_pravu&type=q&w=200&uri=avatars/{$smarty.SESSION.now_user.data.avatar}" 
            alt="user-lk" style="max-width: 200px; max-height: 200px;">
        <label id="label_img" style="display:none;" for="uploadbtn" class="photo-btn" style="cursor: pointer" title="загрузить аватар"></label>
    </div>
    {else}
    <div class="user-info__avatar"><img 
            src="{$mod_dir}/no_avatar.png" alt="user-lk"
            style="max-width: 200px; max-height: 200px;">
        <label id="label_img" style="display:none;" for="uploadbtn" class="photo-btn" style="cursor: pointer" title="загрузить аватар"></label>
    </div>
    {/if}

    <div class="user-info__name">{$smarty.SESSION.now_user.data.name} {$smarty.SESSION.now_user.data.family}</div>

    {*$u_city = Nyos\peticii::getCityId($db, $smarty.session.now_user.data.city)*}

    {*f\pa($u_city)*}

    {if isset($u_city) && $u_city.city|count_characters:true > 0 }
    <div class="user-info__address">{$u_city.city}</div>
    {/if}

    <a href="/{$smarty.const.level}/edit/" class="btn">Редактировать профиль</a>

</div>

<div class='col-xs-6 col-sm-3 col-md-3 col-lg-3' >

    {if $smarty.get.option == 'edit' }
    <span>
        <div class="lk-title">Настройки аккаунта</div>            

        <ul class="lk-action-list">
            <li class="setting-icon"><a href="/{$smarty.const.level}/edit_profile/">Настройки профиля</a></li>

            {if $smarty.SESSION.now_user.data.pass|count_characters:true > 0 || $smarty.SESSION.now_user.data.pass5|count_characters:true > 0 }
            <li class="key-icon"><a href="/{$smarty.const.level}/edit_password/">Сменить пароль</a></li>
            {/if}

            {*
            <li class="mail-icon"><a href="/{$smarty.const.level}/edit_email/">Параметры использования e-mail</a></li>
            *}
            
            <li class="close-icon"><a href="/{$smarty.const.level}/exit/">Выход</a></li>
        </ul>
    </span>
    
    {elseif $smarty.get.option == 'edit_profile' }
    <span>
        <div>

            <div class="lk-title">Контактная информация</div>

            <form class="lk-form" method="post" action="" >

                {*
                <div class="form-group">
                    <div class="input-group"><span class="input-group-addon"><i class="mail-form"></i></span>
                        <input type="email" name='mail' placeholder="e-mail" value="{$smarty.SESSION.now_user.data.mail|escape}" class="form-control">
                    </div>
                </div>
                *}

                <div class="form-group">
                    <div class="input-group"><span class="input-group-addon"><i class="user-form"></i></span>
                        <input type="text" name='name' placeholder="Имя" value="{$smarty.SESSION.now_user.data.name|escape}" class="form-control" >
                    </div>
                </div>

                <div class="form-group">
                    <div class="input-group"><span class="input-group-addon"><i class="user-form"></i></span>
                        <input type="text" name="family" placeholder="Фамилия" value="{$smarty.SESSION.now_user.data.family|escape}" class="form-control">
                    </div>
                </div>

                <div class="form-group"  >
                    <div class="input-group" >
                        <span class="input-group-addon"><i class="location-form"></i></span>
                        {* <input type="text" placeholder="Город" class="form-control"> *}
                        <select id="city1" name="my_city" class="form-control" >

                            <option value="select" >Выберите Ваш город</option>

                            {if $list_city|@count > 0 }
                            {else}
                            {*$list_city = Nyos\peticii::getCity($db)*}
                            {/if}

                            {*f\pa($list_city)*}

                            {foreach $list_city as $key => $val2}
                            {if $val2.status == 'show'}
                            <option value="{$val2.id}" {if $smarty.SESSION.now_user.data.city == $val2.id}selected{/if} >{$val2.city}</option>
                            {/if}
                            {/foreach}

                            {*
                            <option value="1" >Тюмень</option>
                            <option value="2" >Омск</option>
                            <option value="3" >Екат</option>
                            *}

                            <option value="no" {if $smarty.SESSION.now_user.data.city_name|count_characters:true > 1 }selected="selected"{/if} >Укажу название, моего города нет в списке</option>

                        </select>
                    </div>
                </div>

                {literal}
                <script type="text/javascript" charset="utf-8">

                    $(document).ready(function () {

                        $('#city1').change(function () {

                            $s1 = $('#city1 :selected').val();

                            if ($s1 == 'no') {
                                $('#city2').show('slow');
                            } else {
                                $('#city2').hide();
                            }
                        });
                    });

                </script>
                {/literal}


                <div id="city2" style="border-left: 2px solid gray; padding-left: 15px; {if $smarty.SESSION.now_user.data.city_name|count_characters:true == 0 }display: none{/if}" >

                    <div class="form-group">
                        Укажите название вашего населённого&nbsp;пункта
                    </div>

                    <div class="form-group">
                        <div class="input-group"><span class="input-group-addon"><i class="location-form"></i></span>
                            <input type="text" name="my_city2" placeholder="Ваш город" {if $smarty.SESSION.now_user.data.city_name|count_characters:true > 1 }value="{$smarty.SESSION.now_user.data.city_name|escape}"{/if} class="form-control" />
                        </div>
                    </div>

                </div>

                <div class="form-group">
                    <div class="input-group"><span class="input-group-addon"> <i class="location-form"></i></span>
                        <input type="text" name="adres" placeholder="Адрес" 
                               value="{$smarty.SESSION.now_user.data.adres|escape}"
                               class="form-control" />
                    </div>
                </div>

                <div class="form-group">
                    <div class="input-group"><span class="input-group-addon"><i class="phone-form"></i></span>
                        <input type="text" name="phone" placeholder="Номер телефона" 
                               value="{$smarty.SESSION.now_user.data.phone|escape}"
                               maxlength="15"
                               class="form-control" />
                    </div>
                </div>

                <div class="form-group">
                    <textarea placeholder="Обо мне" name="about" >{$smarty.SESSION.now_user.data.about|escape}</textarea>
                </div>

                <div class="text-center">
                    <button type="submit" name="save_edit" value="ok" class="btn btn-grey btn-small">Изменить</button>
                </div>
            </form>

            {*literal}
            <li class="setting-icon"><a href="#" onclick="$('#form_new_baner').toggle('slow'); return false;" >Загрузить аватар</a></li>
            {/literal*}

            <span id="form_new_baner" style="display:none" >
                <div style="background-color:rgba(0,0,0,0.1); padding: 10px; border-radius: 5px;" >

                    <script>
                        $(document).ready(function () {
                            $('#label_img').show();
                        });
                    </script>

                    <form class="lk-form" method="POST" action="/050.lk/edit_profile/" enctype="multipart/form-data" >
                        <div>
                            <input type="file" name="new_avatar"  id="uploadbtn" onchange="this.form.submit();" accept="image/jpeg,image/png,image/gif" placeholder="" class="form-control">
                            <input type="hidden" name="new_ava" value="ok" />
                        </div>
                        <div class="text-center">
                            <button type="submit" name="new_ava2" value="ok" class="btn">Загрузить</button>
                        </div>
                    </form>
                    
                </div>
            </span>            

        </div>
    </span>

    {elseif $smarty.get.option == 'edit_password' }

    <span>

        <div class="lk-title">Сменить пароль</div>

        <form class="lk-form" method="POST" action="" >
            <div class="form-group">
                <div class="input-group"><span class="input-group-addon"><i class="icon-key"></i></span>
                    <input type="password" name="old" placeholder="Действующий пароль" class="form-control" required />
                </div>
            </div>
            <div class="form-group">
                <div class="input-group"><span class="input-group-addon"><i class="icon-key"></i></span>
                    <input type="password" name="new_pass1" placeholder="Новый пароль" class="form-control" required />
                </div>
            </div>
            <div class="form-group">
                <div class="input-group"><span class="input-group-addon"><i class="icon-key"></i></span>
                    <input type="password" name="new_pass2" placeholder="Подтвердить пароль" class="form-control" required />
                </div>
            </div>
            <div class="text-center">
                <button type="submit" name="save_new_pass" value="ok" class="btn btn-grey btn-small">Изменить</button>
            </div>
        </form>            

    </span>

    {elseif $smarty.get.option == 'edit_email' }

    <span>

        {$mail_option = Nyos\mod\lk::getUserOption($db, $smarty.SESSION.now_user.id)}

        {*f\pa($mail_option)*}

        <div class="lk-title">Параметры использования e-mail</div>

        <form class="lk-form lk-form--medium" method="POST" action="" >

            <div class="checkbox-input">
                <input type="checkbox" name="opt_priglasil" value="ok" id="checkbox-122" xclass="checkbox" 
                       {if $mail_option.priglasil|count_characters:true > 0 }checked{/if} />
                <label for="checkbox-122"><span></span> Я пригласил(а) кого-то подписать петицию</label>
            </div>
            <div class="checkbox-input">
                <input type="checkbox" name="opt_obnovleniya_moih" value="ok" id="checkbox-2" xclass="checkbox"
                       {if $mail_option.obnovleniya_moih|count_characters:true > 0 }checked{/if} />
                <label for="checkbox-2"><span></span> Появилось обновление по петиции, которую я подписал(а)</label>
            </div>
            <div class="checkbox-input">
                <input type="checkbox"  name="opt_new_interes" value="ok" id="checkbox-3" class="checkbox"
                       {if $mail_option.new_interes|count_characters:true > 0 }checked{/if} />
                <label for="checkbox-3"><span></span> Появились новые компании, которые могут быть мне интересны</label>
            </div>
            <div class="checkbox-input">
                <input type="checkbox"  name="opt_my_loves" value="ok" id="checkbox-4" class="checkbox"
                       {if $mail_option.my_loves|count_characters:true > 0 }checked{/if} />
                <label for="checkbox-4"><span></span> Кому-то понравились мои комментарии</label>
            </div>
            <div class="checkbox-input">
                <input type="checkbox"  name="opt_answer_on_my" value="ok" id="checkbox-5" class="checkbox"
                       {if $mail_option.answer_on_my|count_characters:true > 0 }checked{/if} />
                <label for="checkbox-5"><span></span> Кто-то ответил на мои комменатрии</label>
            </div>
            <div class="checkbox-input">
                <input type="checkbox"  name="opt_answer_my_coment" value="ok" id="checkbox-6" class="checkbox"
                       {if $mail_option.answer_my_coment|count_characters:true > 0 }checked{/if} />
                <label for="checkbox-6"><span></span> Кто-то ответил на комментарии, на которые я отвтели(а) ранее</label>
            </div>
            <div class="checkbox-input">
                <input type="checkbox"  name="opt_every_nedelya_obzor" value="ok" id="checkbox-7" class="checkbox"
                       {if $mail_option.every_nedelya_obzor|count_characters:true > 0 }checked{/if} />
                <label for="checkbox-7"><span></span> Мой еженедельный обзор петиций  готов</label>
            </div>
            <div class="text-center">
                <button type="submit" name="save_mail_option" value="go" class="btn btn-grey btn-small">Изменить</button>
            </div>
        </form>            

    </span>

    {else}

    {* первый экран если ничего не выбрано *}

    {/if}

    <br/>
    <br/>

</div>


{/strip}